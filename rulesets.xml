<?xml version="1.0" encoding="UTF-8"?>
<ruleset xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      name="MCE Apex Rules"
      xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 http://pmd.sourceforge.net/ruleset_2_0_0.xsd">
   <description>MCE Apex Rules</description>
   <exclude-pattern>.*/.sfdx/.*</exclude-pattern>
   <exclude-pattern>.*/templates/.*</exclude-pattern>
   <exclude-pattern>.*/Application.*</exclude-pattern>
   <exclude-pattern>.*/mocks/.*</exclude-pattern>
   <exclude-pattern>.*/fflib/.*</exclude-pattern>

   <rule ref="category/apex/bestpractices.xml">
      <exclude name="ApexAssertionsShouldIncludeMessage"/>
      <exclude name="ApexUnitTestClassShouldHaveAsserts"/>
      <exclude name="ApexUnitTestClassShouldHaveRunAs" />
      <exclude name="AvoidLogicInTrigger" />
   </rule>

   <rule ref="category/apex/bestpractices.xml/UnusedLocalVariable">
      <properties>
         <property name="violationSuppressXPath" value="//VariableDeclaration/../../../..[ends-with(@Image, 'Selector')]" />
      </properties>
   </rule>

   <rule ref="category/apex/codestyle.xml">
      <exclude name="IfElseStmtsMustUseBraces" />
      <exclude name="IfStmtsMustUseBraces" />
      <exclude name="ForLoopsMustUseBraces" />
      <exclude name="WhileLoopsMustUseBraces" />
      <exclude name="OneDeclarationPerLine" />
   </rule>

   <rule ref="category/apex/design.xml">
      <exclude name="ExcessivePublicCount" />
      <exclude name="TooManyFields" />
      <exclude name="CyclomaticComplexity" />
   </rule>

   <rule ref="category/apex/design.xml/CognitiveComplexity">
      <properties>
         <property name="violationSuppressXPath" value="//ApexFile/UserClass/ModifierNode/Annotation[@Image='IsTest']" />
      </properties>
   </rule>

   <rule ref="category/apex/design.xml/StdCyclomaticComplexity">
      <properties>
         <property name="showClassesComplexity" value="false" />
      </properties>
   </rule>

   <rule ref="category/apex/design.xml/NcssMethodCount">
      <properties>
         <property name="violationSuppressXPath" value="//ApexFile/UserClass/ModifierNode/Annotation[@Image='IsTest']" />
      </properties>
   </rule>

   <rule ref="category/apex/design.xml/NcssTypeCount">
      <properties>
         <property name="violationSuppressXPath" value="//ApexFile/UserClass/ModifierNode/Annotation[@Image='IsTest']" />
      </properties>
   </rule>

   <rule ref="category/apex/errorprone.xml">
      <exclude name="EmptyStatementBlock" />
   </rule>

   <rule ref="category/apex/errorprone.xml/EmptyCatchBlock">
      <properties>
         <property name="allowCommentedBlocks" value="true" />
      </properties>
   </rule>

   <rule ref="category/apex/errorprone.xml/AvoidHardcodingId">
      <properties>
         <property name="violationSuppressXPath" value="//ApexFile/UserClass/ModifierNode/Annotation[@Image='IsTest']" />
      </properties>
   </rule>

   <rule ref="category/apex/multithreading.xml" />

   <rule ref="category/apex/performance.xml" />

   <rule ref="category/apex/performance.xml/EagerlyLoadedDescribeSObjectResult">
      <properties>
         <property name="violationSuppressXPath" value="//ReferenceExpression[lower-case(@Image) = 'fielddescribeoptions']" />
      </properties>
   </rule>

   <rule ref="category/apex/security.xml">
      <exclude name="ApexDangerousMethods" />
      <exclude name="ApexOpenRedirect" />
      <exclude name="ApexSuggestUsingNamedCred" />
      <exclude name="ApexXSSFromURLParam" />
   </rule>

   <rule ref="category/apex/security.xml/ApexCRUDViolation" message="Validate CRUD permission before SOQL/DML operation">
      <priority>3</priority>
      <properties>
         <property name="createAuthMethodPattern" value="AuthorizationUtil\.(is|assert)(Createable|Upsertable)"/>
         <property name="readAuthMethodPattern" value="AuthorizationUtil\.(is|assert)Accessible"/>
         <property name="updateAuthMethodPattern" value="AuthorizationUtil\.(is|assert)(Updateable|Upsertable)"/>
         <property name="deleteAuthMethodPattern" value="AuthorizationUtil\.(is|assert)Deletable"/>
         <property name="undeleteAuthMethodPattern" value="AuthorizationUtil\.(is|assert)Undeletable"/>
      </properties>
   </rule>

   <rule name="NoUnderscoresInFieldNames" language="xml" message="Custom fields should not contain underscores." class="net.sourceforge.pmd.lang.rule.xpath.XPathRule">
      <properties>
          <property name="xpath">
            <value><![CDATA[
               //CustomField/fullName/text[matches(@Image, ".*_.*__c")]
            ]]></value>
         </property>
         <property name="violationSuppressXPath">
            <value><![CDATA[
               //CustomField/fullName/text[
                  @Image="A_recontacter__c"
                  or @Image="Abo_GAZ_TEG__c"
                  or @Image="Abo_Mon_Hebdo__c"
                  or @Image="Abonnement_en_MWh__c"
                  or @Image="Abonnement_Gaz_en_an__c"
                  or @Image="Accord_client_SGEOMEGA__c"
                  or @Image="Alerte_news_reglementaires__c"
                  or @Image="Autres_termes_fixe_en_an__c"
                  or @Image="Budget_Elec_HTT_an__c"
                  or @Image="Budget_Gaz_HTT_an__c"
                  or @Image="Budget_hors_TVA_en_an__c"
                  or @Image="Budget_hors_TVA_en_MWh__c"
                  or @Image="Budget_HTT_en_an__c"
                  or @Image="Budget_HTT_en_MWh__c"
                  or @Image="Bugdet_HTT_en_MWh__c"
                  or @Image="Budget_HTVA_en_an__c"
                  or @Image="Budget_HTVA_en_MWh__c"
                  or @Image="Budget_Mensuel_Elec__c"
                  or @Image="Budget_Mensuel_Gaz__c"
                  or @Image="Budget_TTC_en_an__c"
                  or @Image="Budget_TTC_en_MWh__c"
                  or @Image="Capacit_en_MWh__c"
                  or @Image="Capacite_en_MWh__c"
                  or @Image="CAR_Actuel_en_MWh__c"
                  or @Image="CAR_Future_en_MWh__c"
                  or @Image="Categorie_de_contact__c"
                  or @Image="CEE_Affiche__c"
                  or @Image="CEE_en_MWh__c"
                  or @Image="CEE_x_Volume__c"
                  or @Image="Classe_de_consommation__c"
                  or @Image="Client_MCE__c"
                  or @Image="Co_t_de_capacit_distribution_en_an__c"
                  or @Image="Code_APE__c"
                  or @Image="Code_couleur__c"
                  or @Image="Code_INSEE__c"
                  or @Image="Code_Postal__c"
                  or @Image="Code_SIRET__c"
                  or @Image="Complement_d_adresse__c"
                  or @Image="Commentaires_segment_Lead__c"
                  or @Image="Consommation_totale__c"
                  or @Image="Contact_principal__c"
                  or @Image="Contact_Principal__c"
                  or @Image="Contrat_de_maintenance__c"
                  or @Image="Contrat_signe__c"
                  or @Image="Creditsafe_password__c"
                  or @Image="Creditsafe_username__c"
                  or @Image="CTA_en_an__c"
                  or @Image="CTA_TEG__c"
                  or @Image="Cycle_de_facturation__c"
                  or @Image="Date_de_cotation__c"
                  or @Image="Date_de_d_but_de_contrat__c"
                  or @Image="Date_de_debut_de_contrat__c"
                  or @Image="Date_de_fin_de_contrat__c"
                  or @Image="Date_de_Rappel__c"
                  or @Image="Date_de_rappel__c"
                  or @Image="Date_factur_Lead_Agence__c"
                  or @Image="Date_factur_Lead_Partenaire__c"
                  or @Image="Date_facture_Lead_Agence__c"
                  or @Image="Date_facture_Lead_Partenaire__c"
                  or @Image="Date_limite_de_nego_Elec__c"
                  or @Image="Date_limite_de_nego_Gaz__c"
                  or @Image="Demande_d_offre_manuelle__c"
                  or @Image="Distribution_fixe_en_an__c"
                  or @Image="Distribution_variable_en_MWh__c"
                  or @Image="Duree_en_mois__c"
                  or @Image="Energie_en_an__c"
                  or @Image="Energie_en_euro_MWh__c"
                  or @Image="Envoi_de_infos_factu__c"
                  or @Image="Factur_Lead_Agence__c"
                  or @Image="Factur_Lead_Partenaire__c"
                  or @Image="Frequence_de_releve_Gaz__c"
                  or @Image="Forme_Juridique_Globale__c"
                  or @Image="Gazprom_CheckSiren_Domain__c"
                  or @Image="Gazprom_CheckSiren_Id_SoEnergie__c"
                  or @Image="Gazprom_CheckSiren_Token__c"
                  or @Image="Gazprom_CotationBroker_UserId__c"
                  or @Image="Heure_de_disponibilit__c"
                  or @Image="ID_COMPTE_SF1_0__c"
                  or @Image="INTITULE_BANQUE__c"
                  or @Image="JOUR_DE_DISPONIBILIT__c"
                  or @Image="Jour_de_disponibilit__c"
                  or @Image="Marge_Brute__c"
                  or @Image="Marge_en_MWh__c"
                  or @Image="Message_partenaire__c"
                  or @Image="Mode_de_facturation__c"
                  or @Image="Mois_de_validation_ADV_c__c"
                  or @Image="Nom_du_point_de_facturation__c"
                  or @Image="Nombre_de_site_Elec__c"
                  or @Image="Nombre_de_site_Gaz__c"
                  or @Image="Nombre_etablissement__c"
                  or @Image="Parent_001__c"
                  or @Image="Parent_00Q__c"
                  or @Image="Parent_0Q0__c"
                  or @Image="Parent_a0f__c"
                  or @Image="Partenaire_a_facturer__c"
                  or @Image="Potentiel_Elec__c"
                  or @Image="Potentiel_Elec_Compte__c"
                  or @Image="Potentiel_Elec_Sites__c"
                  or @Image="Potentiel_Gaz__c"
                  or @Image="Potentiel_Gaz_Compte__c"
                  or @Image="Potentiel_Gaz_Sites__c"
                  or @Image="Preavis_contrat_Elec__c"
                  or @Image="Preavis_contrat_Gaz__c"
                  or @Image="Prix_Base_en_MWh__c"
                  or @Image="Prix_capacit_MWh_x_Volume__c"
                  or @Image="Prix_CEE_MWh_x_Volume_des_sites__c"
                  or @Image="Prix_du_MWh_en_MWh__c"
                  or @Image="Prix_du_MWh_HC_en_MWh__c"
                  or @Image="Prix_du_MWh_HC_x_Volume_HC_des_sites__c"
                  or @Image="Prix_du_MWh_HCE_en_MWh__c"
                  or @Image="Prix_du_MWh_HCE_x_Volume_HCE_des_sites__c"
                  or @Image="Prix_du_MWh_HCH_en_MWh__c"
                  or @Image="Prix_du_MWh_HCH_x_Volume_HCH_des_sites__c"
                  or @Image="Prix_du_MWh_HP_en_MWh__c"
                  or @Image="Prix_du_MWh_HP_x_Volume_HP_des_sites__c"
                  or @Image="Prix_du_MWh_HPE_en_MWh__c"
                  or @Image="Prix_du_MWh_HPE_x_Volume_HPE_des_sites__c"
                  or @Image="Prix_du_MWh_HPH_en_MWh__c"
                  or @Image="Prix_du_MWh_HPH_x_Volume_HPH_des_sites__c"
                  or @Image="Prix_du_MWh_Pointe_en_MWh__c"
                  or @Image="Prix_du_MWh_Pointe_x_Volume_Pointe_des_s__c"
                  or @Image="Prix_du_MWh_x_Volume_Base__c"
                  or @Image="Prix_Energie_verte_x_Volume__c"
                  or @Image="Prix_nergie_verte_MWh__c"
                  or @Image="Prix_nergie_verte_MWh_des_sites__c"
                  or @Image="Proprietaire_du_compteur__c"
                  or @Image="QAC_en_MWh__c"
                  or @Image="RAE_ou_PCE__c"
                  or @Image="Reference_client__c"
                  or @Image="Reference_telepro__c"
                  or @Image="Renouvellement_Grille_B2B_MCE__c"
                  or @Image="Renouvellement_Grille_B2B_Non_MCE__c"
                  or @Image="Renouvellement_Grille_B2C_MCE__c"
                  or @Image="Renouvellement_Grille_B2C_non_MCE__c"
                  or @Image="Renouvellement_Sur_Mesure__c"
                  or @Image="Renouvellement_Sur_Mesure_MCE__c"
                  or @Image="Reprise_de_commission__c"
                  or @Image="Sans_Engagement_Elec__c"
                  or @Image="Sans_Engagement_Gaz__c"
                  or @Image="ScoresDecisions_password__c"
                  or @Image="ScoresDecisions_username__c"
                  or @Image="Segment_Elec__c"
                  or @Image="Segment_Electricite__c"
                  or @Image="Segment_Gaz__c"
                  or @Image="Segment_Lead__c"
                  or @Image="Site_internet__c"
                  or @Image="Taxes_hors_TVA_en_an__c"
                  or @Image="Taxes_hors_TVA_en_MWh__c"
                  or @Image="TECH_CAR__c"
                  or @Image="Telehone_mobile_BtoB__c"
                  or @Image="Tension_de_raccordement_Elec__c"
                  or @Image="Termes_Fixes_en_an__c"
                  or @Image="Total_Elec__c"
                  or @Image="Transmission_contrats_manuels__c"
                  or @Image="Transport_fixe_en_an__c"
                  or @Image="Type_de_commission__c"
                  or @Image="Type_de_facturation__c"
                  or @Image="Type_fileupload__c"
                  or @Image="TURPE_en_MWh__c"
                  or @Image="Validation_ADV_agence__c"
                  or @Image="Validation_fournisseur__c"
                  or @Image="Validite_accord_client_SGE_OMEGA__c"
                  or @Image="Version_Elec__c"
                  or @Image="Volume_annuel_Elec_en_kWh__c"
                  or @Image="Volume_annuel_Gaz_en_kWh__c"
                  or @Image="Volume_Base_en_MWh_an__c"
                  or @Image="Volume_contrat_MWh__c"
                  or @Image="Volume_en_MWh_an__c"
                  or @Image="Volume_HC_en_MWh_an__c"
                  or @Image="Volume_HCE_en_MWh_an__c"
                  or @Image="Volume_HCH_en_MWh_an__c"
                  or @Image="Volume_HP_en_MWh_an__c"
                  or @Image="Volume_HPE_en_MWh_an__c"
                  or @Image="Volume_HPH_en_MWh_an__c"
                  or @Image="Volume_Pointe_en_MWh_an__c"
                  or @Image="Volume_total_contrat_en_MWh__c"
               ]
            ]]></value>
         </property>
      </properties>
   </rule>

   <rule name="ViewAllOnPermSet" language="xml" message="Allowing this user permission can give access to sensitive data." class="net.sourceforge.pmd.lang.rule.xpath.XPathRule">
      <priority>3</priority>
      <properties>
         <property name="xpath">
            <value><![CDATA[
            //PermissionSet/userPermissions[ name/text[@Image='ViewAllData'] and enabled/text[@Image='true'] ]
            ]]> </value>
         </property>
      </properties>
   </rule>
</ruleset>